var router = require('koa-router')(),
    data = require('app/model').data,
    config = require('app/config');

router.get('/transport/buses.json', function *(next) {
  this.set('Content-Type', 'application/json');
  this.body = JSON.stringify(data.buses, null, 2);
});

router.get('/transport/stops.json', function *(next) {
  this.set('Content-Type', 'application/json');
  this.body = JSON.stringify(data.stops, null, 2);
});

router.get('/transport/lines.json', function *(next) {
  this.set('Content-Type', 'application/json');
  this.body = JSON.stringify(data.lines, function (k, v) {
    if (k === 'positions' || k === 'pos') {
      return undefined;
    }
    return v;
  }, 2);
});

router.get('/transport/latencies.json', function *(next) {
  this.set('Content-Type', 'application/json');
  this.body = JSON.stringify(data.lines, function (k, v) {
    if (k === 'positions' ||
        k === 'pos' ||
        k === 'stops' ||
        k === 'departures' ||
        k === 'dTimes') {
      return undefined;
    }
    return v;
  }, 2);
});

router.get('/transport/rawData.json', function *(next) {
  this.set('Content-Type', 'application/json');
  this.body = JSON.stringify(data, null, 2);
});

router.get('/transport/streetMap.txt', function *(next) {
  this.set('Content-Type', 'text/plain');
  this.body = require('app/utils/streetMap')(data, config.gridSize);
});

router.get('/transport/stopNames.json', function *(next) {
  this.set('Content-Type', 'application/json');
  this.body = JSON.stringify(require('app/fixtures/stopNames'), null, 2);
});

module.exports = router;
